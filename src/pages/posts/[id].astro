---
import PostLayout from "@layouts/PostLayout.astro";
import { FormatoFecha } from "@util/FormatoFecha";
import type { GetStaticPaths } from "astro";
import { Image } from "astro:assets";
import { getEntry } from "astro:content";
import { render } from "astro:content";
import { getCollection } from "astro:content";

export const getStaticPaths = (async () => {
    
    const blogPosts = await getCollection("blog");
    
    return blogPosts.map( (post) => ({
            params: {id: post.id},
            props: { post: post }
        }) 
    );
}) satisfies GetStaticPaths;

const { post } = Astro.props;
const { Content, headings } = await render(post);
const autor = await getEntry("autor", post.data.autor.id)!;
---
<PostLayout title={post.data.titulo}>
    <h4 class="text-gray-400 text-1xl my-5">
        Publicado el { FormatoFecha.formatea(post.data.fecha) }
    </h4>
    <div class="flex items-center ml-5 pb-5">
        <Image src={autor.data.avatar} alt={autor.data.nombre} 
        width={50} height={50} class="rounded-full"} />
        <h1 class="text-gray-500 text-2xl ml-5">
            Escrito por <a href={`/autor/${post.data.autor.id}`}>{ autor.data.nombre }</a>
        </h1>
    </div>
    <hr>

        <Image src={post.data.imagen} alt={post.data.titulo} 
        class="object-cover w-full h-[300px] my-4 rounded" />

        <h4 class="text-blue-400 text-2xl my-5">Tabla de contenido</h4>
        <ol class="mb-5">
            {
                headings.map( (heading, index) => (
                    <li>
                        <a href={`#${heading.slug}`}>{ index+1 } - {heading.text}</a>
                    </li>
                ) )
            }
        </ol>
    <hr class="mb-5">
    <Content />
    <div class="my-12">
        <a href="#btn-regresar" class="text-blue-500">Volver arriba</a>
    </div>
</PostLayout>